# MGIT v1 - 产品设计

## 1. 产品概述

### 1.1 产品定位

MGIT是一个用Rust开发的多仓库Git管理工具，专为需要同时管理多个Git仓库的团队设计。它通过配置文件驱动的方式，实现团队环境的一致性管理，解决了多项目开发中的协作效率问题。

**核心定位**：
- **团队协作工具**：专注于多人的仓库状态同步和协作
- **配置驱动管理**：通过声明式配置文件实现仓库的批量管理
- **双界面支持**：提供CLI和GUI两种使用方式，满足不同用户需求

### 1.2 核心价值主张

#### 统一环境管理
MGIT通过单一配置文件统一管理项目中所有子仓库的状态，确保团队成员拥有完全一致的开发环境。无论是功能开发、版本测试还是问题排查，都能通过配置文件实现快速环境切换。

#### 配置文件版本化
所有配置文件都进行独立版本控制，支持功能开发、测试验证、版本发布等不同阶段的配置管理。团队可以轻松追踪配置变更历史，实现配置的回滚和恢复。

#### 高效并发处理
基于Rust的高性能特性和Rayon并发框架，MGIT能够高效处理多个仓库的并行操作，显著提升大规模仓库管理的效率，支持可配置的线程数量控制。

### 1.3 目标用户和使用场景

#### 主要用户群体

**多项目开发团队**
- 项目包含10个以内子仓库的开发团队
- 需要统一管理多个功能模块的开发组
- 进行微服务架构开发的团队

**DevOps工程师和团队负责人**
- 负责维护项目环境一致性的工程师
- 需要进行版本发布管理的团队负责人
- 管理CI/CD流程的运维人员

**需要频繁交接工作的开发人员**
- 跨时区协作的分布式团队
- 项目轮岗和人员流动频繁的团队
- 外包和众包项目参与者

#### 核心使用场景

**功能开发阶段的分支同步协作**
```
开发者A完成功能A → 创建功能配置文件 → 开发者B同步配置 → 继续协作开发
```

使用示例：
```bash
# 开发者A完成功能后创建配置
mgit snapshot --config feature/npc_ai.toml --branch

# 开发者B获取配置并同步
mgit sync --config feature/npc_ai.toml
```

**版本测试时的环境统一部署**
```
开发完成 → 创建测试版本配置 → 测试团队同步 → 统一环境验证 → 发现问题 → 同步修复版本
```

使用示例：
```bash
# 测试团队同步到指定版本
mgit sync --config release/v0.1.0.toml

# 发现问题后同步到修复版本
mgit sync --config hotfix/critical_fix.toml
```

**问题排查时的commit级别快速响应**
```
线上问题 → 定位问题commit → 创建问题排查配置 → 相关人员同步 → 联合分析修复
```

### 1.4 产品特色和优势

#### 技术优势

**Rust原生性能**
- 内存安全保证，避免常见的内存泄漏和越界问题
- 零拷贝优化，最大化数据处理效率
- 原生编译，启动速度快，运行效率高

**egui现代GUI**
- 基于immediate mode的现代GUI框架
- 跨平台支持，界面风格统一
- 轻量级部署，无需复杂的GUI依赖

**外部Git命令安全机制**
- 不依赖libgit2，直接调用系统Git命令
- 兼容各种Git版本和配置
- 充分利用用户现有的Git环境设置

#### 协作优势

**配置文件独立版本控制**
- 配置文件在独立仓库中进行版本管理
- 支持分支、标签、合并等完整Git操作
- 配置变更历史可追踪、可回滚

**权限继承机制**
- 完全依赖用户在各个子仓库的现有Git权限
- 无需配置额外的权限系统
- SSH密钥、访问令牌等认证信息统一管理

#### 性能优势

**Rayon并发处理**
- 基于工作窃取算法的高性能并发框架
- 自动负载均衡，充分利用多核CPU
- 可配置线程池大小，适应不同硬件环境

**跨平台支持**
- 支持Windows(x86_64)、Linux(x86_64/aarch64)、macOS(x86_64/aarch64)
- 统一的构建和发布流程
- 自动化跨平台测试和验证

**原生编译优化**
- 发布版本经过深度优化
- 二进制文件体积小
- 启动速度快，资源占用少

## 2. 安装指南

### 2.1 系统要求

#### 支持的操作系统

**Windows**
- Windows 10 1903或更高版本
- Windows 11 (所有版本)
- 架构支持：x86_64

**Linux**
- Ubuntu 18.04 LTS或更高版本
- CentOS 7或更高版本
- Debian 10或更高版本
- 架构支持：x86_64、aarch64

**macOS**
- macOS 10.15 Catalina或更高版本
- 架构支持：x86_64 (Intel)、aarch64 (Apple Silicon)

#### 软件依赖

**Git环境**
- Git 2.0或更高版本（推荐2.30+）
- 支持HTTPS、SSH协议
- 配置好的用户名和邮箱

**可选依赖**
- Rust 1.76.0+（仅源码编译需要）
- C++编译器（Linux GUI版本需要）
- GTK3开发库（Linux GUI版本需要）

### 2.2 安装方式

#### 预编译二进制文件安装

**从GitHub Releases下载**
1. 访问项目GitHub Releases页面
2. 根据操作系统选择对应的二进制包
3. 解压到目标目录
4. 将可执行文件路径添加到系统PATH

**版本说明**
- CLI版本标签格式：`1.5.1`
- GUI版本标签格式：`gui-1.5.1`
- 支持自动更新检查（GUI版本）

**包管理器安装**
```bash
# Windows (Chocolatey)
choco install mgit

# macOS (Homebrew)
brew install mgit

# Linux (需要添加对应的包管理器源)
```

#### 从源码编译安装

**环境准备**
```bash
# 安装Rust工具链
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
source ~/.cargo/env

# 验证安装
rustc --version
cargo --version
```

**Linux GUI依赖安装**
```bash
# Ubuntu/Debian
sudo apt update
sudo apt-get install -y \
    gcc g++ \
    cmake pkg-config \
    fontconfig \
    libgtk-3-dev

# CentOS/RHEL
sudo yum groupinstall "Development Tools"
sudo yum install gtk3-devel
```

**编译构建**
```bash
# 克隆代码仓库
git clone https://github.com/funny/mgit.git
cd mgit

# 构建整个工作空间
cargo build --release

# 仅构建CLI
cargo build -p mgit-cli --release

# 仅构建GUI
cargo build -p mgit-gui --release
```

**安装到系统路径**
```bash
# Linux/macOS
sudo cp target/release/mgit /usr/local/bin/
sudo cp target/release/mgit-gui /usr/local/bin/

# Windows
copy target\release\mgit.exe C:\Program Files\Git\bin\
copy target\release\mgit-gui.exe C:\Program Files\Git\bin\
```

### 2.3 前置条件

#### Git环境配置

**SSH密钥配置（推荐）**
```bash
# 生成SSH密钥
ssh-keygen -t rsa -b 4096 -C "your_email@example.com"

# 添加到SSH agent
eval "$(ssh-agent -s)"
ssh-add ~/.ssh/id_rsa

# 测试连接
ssh -T git@github.com
```

**个人访问令牌配置**
```bash
# 配置Git凭据缓存
git config --global credential.helper store

# 使用时输入用户名和token
git clone https://github.com/user/repo.git
# Username: your_username
# Password: your_personal_access_token
```

**Git全局配置**
```bash
# 设置用户信息
git config --global user.name "Your Name"
git config --global user.email "your_email@example.com"

# 设置默认编辑器
git config --global core.editor "code --wait"

# 设置默认分支名
git config --global init.defaultBranch main
```

#### 网络和代理配置

**HTTP/HTTPS代理设置**
```bash
# Git代理配置
git config --global http.proxy http://proxy.company.com:8080
git config --global https.proxy https://proxy.company.com:8080

# SSH代理配置（编辑 ~/.ssh/config）
Host github.com
    ProxyCommand nc -X connect -x proxy.company.com:8080 %h %p
```

#### 开发环境依赖

**Windows环境**
- 安装Visual Studio 2019或更高版本（包含C++编译器）
- Windows 10 SDK
- Git for Windows

**macOS环境**
- Xcode Command Line Tools
```bash
xcode-select --install
```

**Linux环境**
- 基础开发工具包
```bash
# Ubuntu/Debian
sudo apt install build-essential

# CentOS/RHEL
sudo yum groupinstall "Development Tools"
```

## 3. 功能模块详解

### 3.1 核心操作模块

#### 3.1.1 初始化模块 (init)

**功能描述**
初始化模块能够智能扫描指定目录下的所有Git仓库，自动生成标准化的配置文件。支持递归扫描，可以识别嵌套的Git仓库结构。

**关键特性**
- **智能识别**：自动检测.git目录，识别Git仓库
- **路径处理**：支持相对路径和绝对路径
- **强制覆盖**：支持强制覆盖现有配置文件
- **格式验证**：生成的配置文件经过格式验证

**使用示例**
```bash
# 基本初始化
mgit init

# 初始化指定目录
mgit init /path/to/project

# 强制覆盖现有配置
mgit init --force

# 忽略特定目录
mgit init --ignore ./temp --ignore ./backup
```

**配置文件输出示例**
```toml
# 自动生成的 .gitrepos 文件
version = "1.5.1"
default-branch = "main"
default-remote = "origin"

[[repos]]
local = "core-lib"
remote = "https://github.com/team/core-lib.git"

[[repos]]
local = "frontend"
remote = "https://github.com/team/frontend.git"

[[repos]]
local = "docs"
remote = "https://github.com/team/docs.git"
```

#### 3.1.2 快照模块 (snapshot)

**功能描述**
快照模块记录当前所有仓库的精确状态，包括分支、标签或具体的commit哈希。支持不同级别的快照策略，适用于不同的使用场景。

**关键特性**
- **分支快照**：记录当前所在分支
- **提交快照**：记录精确的commit哈希
- **选择性记录**：可以忽略特定目录
- **状态验证**：快照前验证仓库状态

**使用示例**
```bash
# 创建分支快照
mgit snapshot --branch

# 创建提交快照
mgit snapshot --commit

# 指定输出配置文件
mgit snapshot --config release/v1.0.0.toml

# 强制覆盖现有配置
mgit snapshot --force

# 忽略特定目录
mgit snapshot --ignore ./temp --ignore ./logs
```

**应用场景**
- **功能开发完成**：记录功能分支状态，便于其他开发者同步
- **版本发布前**：锁定所有仓库的发布状态
- **问题排查**：记录问题发生时的精确状态

#### 3.1.3 同步模块 (sync)

**功能描述**
同步模块是MGIT的核心功能，根据配置文件批量更新所有子仓库到指定状态。支持并发处理、安全机制和高级Git操作。

**关键特性**
- **并发处理**：使用Rayon实现高效并行处理
- **状态优先级**：commit > tag > branch > default-branch
- **安全机制**：支持stash和hard reset选项
- **Sparse checkout**：支持稀疏检出优化
- **深度控制**：支持浅克隆减少网络传输

**使用示例**
```bash
# 基本同步
mgit sync

# 使用指定配置文件
mgit sync --config feature/npc_ai.toml

# 设置线程数
mgit sync --thread 8

# 同步前暂存本地改动
mgit sync --stash

# 强制重置，忽略本地改动
mgit sync --hard

# 不自动迁出新分支
mgit sync --no-checkout

# 设置克隆深度
mgit sync --depth 1

# 静默模式
mgit sync --silent

# 忽略特定目录
mgit sync --ignore ./temp
```

**工作流程**
1. **读取配置文件**：解析.gitrepos或指定配置文件
2. **验证仓库状态**：检查本地仓库状态和权限
3. **并发处理**：并行执行同步操作
4. **状态报告**：显示同步结果和错误信息

#### 3.1.4 获取更新模块 (fetch)

**功能描述**
获取更新模块批量获取远程仓库的最新信息，但不修改本地工作目录状态。适用于预览更新和减少网络带宽消耗的场景。

**关键特性**
- **批量获取**：一次性获取所有远程仓库更新
- **不修改本地**：只更新远程分支信息
- **并发处理**：支持并发获取
- **深度控制**：支持浅克隆

**使用示例**
```bash
# 基本获取更新
mgit fetch

# 使用指定配置文件
mgit fetch --config feature/npc_ai.toml

# 设置线程数
mgit fetch --thread 4

# 设置获取深度
mgit fetch --depth 1

# 静默模式
mgit fetch --silent
```

**应用场景**
- **更新预览**：查看远程仓库的更新情况
- **网络优化**：在网络环境不佳时减少带宽使用
- **CI/CD集成**：在构建前获取最新代码信息

#### 3.1.5 清理模块 (clean)

**功能描述**
清理模块根据配置文件安全删除不在配置中的本地仓库，帮助用户管理磁盘空间和保持项目整洁。

**关键特性**
- **安全删除**：只删除不在配置文件中的仓库
- **确认机制**：删除前需要用户确认
- **dry-run模式**：预览将要删除的仓库
- **保护重要仓库**：可以设置保护列表

**使用示例**
```bash
# 基本清理（需要确认）
mgit clean

# 使用指定配置文件
mgit clean --config feature/npc_ai.toml

# 预览删除操作
mgit clean --dry-run

# 强制删除（跳过确认）
mgit clean --force
```

**安全机制**
- 默认需要用户确认每个删除操作
- 支持dry-run模式预览影响
- 检查仓库是否有未提交的改动
- 支持保护重要仓库不被误删

#### 3.1.6 分支跟踪模块 (track)

**功能描述**
分支跟踪模块批量设置本地分支与远程分支的跟踪关系，简化后续的pull/push操作，确保分支关系的正确性。

**关键特性**
- **批量设置**：一次性设置所有仓库的分支跟踪
- **智能匹配**：自动匹配对应的远程分支
- **自定义映射**：支持自定义分支映射关系
- **验证机制**：设置前验证分支存在性

**使用示例**
```bash
# 基本跟踪设置
mgit track

# 使用指定配置文件
mgit track --config feature/npc_ai.toml

# 指定默认远程仓库
mgit track --remote upstream

# 跟踪指定分支
mgit track --branch main
```

### 3.2 高级功能模块

#### 3.2.1 文件浏览模块 (ls-files)

**功能描述**
文件浏览模块提供跨仓库的文件结构浏览和搜索功能，帮助用户快速定位文件在不同仓库中的位置。

**关键特性**
- **统一文件树**：显示所有仓库的合并文件树
- **快速搜索**：支持文件名和路径的模糊搜索
- **模式匹配**：支持通配符和正则表达式
- **文件过滤**：支持按文件类型过滤

**使用示例**
```bash
# 显示所有文件
mgit ls-files

# 使用指定配置文件
mgit ls-files --config feature/npc_ai.toml

# 搜索特定文件
mgit ls-files --pattern "*.md"

# 按文件类型过滤
mgit ls-files --type rust
```

#### 3.2.2 仓库日志模块 (log-repos)

**功能描述**
仓库日志模块聚合显示多个仓库的提交历史，支持时间范围过滤和变更统计，便于版本管理和问题追踪。

**关键特性**
- **聚合日志**：合并显示多个仓库的提交历史
- **时间过滤**：支持时间范围过滤
- **变更统计**：显示文件变更统计信息
- **格式化输出**：支持多种输出格式

**使用示例**
```bash
# 显示所有仓库日志
mgit log-repos

# 使用指定配置文件
mgit log-repos --config feature/npc_ai.toml

# 时间范围过滤
mgit log-repos --since "2024-01-01" --until "2024-01-31"

# 显示变更统计
mgit log-repos --stat

# 限制显示数量
mgit log-repos --limit 50
```

#### 3.2.3 分支管理模块 (new-branch/del-branch)

**功能描述**
分支管理模块提供批量创建和删除远程分支的功能，支持原子性操作和错误回滚，确保分支操作的可靠性。

**关键特性**
- **批量创建**：一次性创建多个远程分支
- **批量删除**：安全删除远程分支
- **原子性操作**：要么全部成功，要么全部回滚
- **保护机制**：防止误删除重要分支

**使用示例**
```bash
# 创建远程分支
mgit new-branch feature/new-ui --from main

# 删除远程分支
mgit del-branch feature/old-ui

# 使用指定配置文件
mgit new-branch --config feature/npc_ai.toml
```

#### 3.2.4 标签管理模块 (new-tag)

**功能描述**
标签管理模块提供批量创建和管理标签的功能，支持标签签名和里程碑标记，便于版本发布和管理。

**关键特性**
- **批量创建**：一次性为多个仓库创建标签
- **标签签名**：支持GPG签名标签
- **里程碑标记**：支持里程碑标签
- **验证机制**：创建前验证标签唯一性

**使用示例**
```bash
# 创建标签
mgit new-tag v1.0.0 --commit abc123

# 创建签名标签
mgit new-tag v1.0.0 --sign --message "Release version 1.0.0"

# 使用指定配置文件
mgit new-tag --config release/v1.0.0.toml
```

### 3.3 GUI界面功能模块

#### 3.3.1 项目管理模块

**功能描述**
项目管理模块提供多项目的管理和快速切换功能，记住用户的项目历史，提供便捷的项目访问体验。

**关键特性**
- **项目记忆**：自动记住最近使用的项目
- **快速切换**：支持快速切换不同项目
- **项目搜索**：支持项目名称和路径搜索
- **工作区隔离**：不同项目的配置完全隔离

**界面特点**
- 左侧项目列表显示
- 最近项目置顶显示
- 支持项目拖拽排序
- 项目状态指示器

#### 3.3.2 配置文件管理模块

**功能描述**
配置文件管理模块提供可视化的配置文件选择和管理功能，支持外部配置加载和语义化命名。

**关键特性**
- **配置文件列表**：显示项目相关的所有配置文件
- **语义化命名**：支持按类型和版本组织配置文件
- **外部配置加载**：支持从任意位置加载配置文件
- **配置预览**：预览配置文件内容

**界面特点**
- 配置文件树状显示
- 配置文件内容预览面板
- 快速搜索和过滤功能
- 最近使用的配置文件置顶

#### 3.3.3 仓库状态监控模块

**功能描述**
仓库状态监控模块实时显示所有仓库的状态信息，包括Ahead/Behind信息、本地改动状态等，提供直观的可视化指示。

**关键特性**
- **状态可视化**：通过颜色和图标显示仓库状态
- **详细信息**：显示具体的差异和改动信息
- **实时更新**：状态信息实时更新
- **状态过滤**：支持按状态过滤仓库

**界面特点**
- 仓库列表状态指示器
- 工具提示显示详细信息
- 状态过滤和排序
- 批量状态操作

#### 3.3.4 批量操作界面模块

**功能描述**
批量操作界面模块提供图形化的批量操作执行界面，显示操作进度和结果，提供友好的用户交互体验。

**关键特性**
- **进度显示**：实时显示操作进度
- **操作日志**：详细的操作日志记录
- **错误友好提示**：用户友好的错误信息
- **操作控制**：支持暂停、继续、取消操作

**界面特点**
- 进度条显示
- 操作日志面板
- 错误信息高亮
- 操作控制按钮

#### 3.3.5 设置管理模块

**功能描述**
设置管理模块提供用户偏好和项目设置的管理功能，支持全局设置和项目特定配置的个性化定制。

**关键特性**
- **全局设置**：影响所有项目的全局配置
- **项目特定设置**：针对特定项目的配置
- **界面主题**：支持多种界面主题
- **配置导入导出**：支持配置的备份和恢复

**界面特点**
- 分类设置页面
- 设置搜索功能
- 配置重置功能
- 设置预览功能

## 4. API参考

### 4.1 CLI命令完整参考

#### 核心命令

**mgit init** - 初始化配置
```bash
用法: mgit init [OPTIONS] [PATH]

参数:
  [PATH]  要扫描的目录路径，默认为当前目录

选项:
  -f, --force <FORCE>  强制覆盖已存在的配置文件
  -i, --ignore <IGNORE>  忽略的目录，可多次使用 [env: MGIT_IGNORE=]
  -h, --help           显示帮助信息

示例:
  mgit init                    # 初始化当前目录
  mgit init /path/to/project   # 初始化指定目录
  mgit init --force            # 强制覆盖现有配置
  mgit init --ignore ./temp    # 忽略temp目录
```

**mgit sync** - 同步仓库
```bash
用法: mgit sync [OPTIONS] [PATH]

参数:
  [PATH]  要操作的项目路径，默认为当前目录

选项:
  -c, --config <CONFIG>  指定配置文件路径，默认为.gitrepos
  -t, --thread <THREAD>  设置线程数量，默认为4 [env: MGIT_THREAD=4]
      --silent          在sync中启用静默播报模式
      --no-track        在sync后不跟踪远端分支
      --no-checkout     在sync后不迁出新的远端分支
      --stash           在sync前暂存本地改动
      --hard            在sync前忽略所有本地改动
      --depth <DEPTH>    设置sync的深度 [env: MGIT_DEPTH=]
  -i, --ignore <IGNORE>  忽略的目录，可多次使用 [env: MGIT_IGNORE=]
  -h, --help            显示帮助信息

示例:
  mgit sync                                    # 基本同步
  mgit sync --config feature/npc_ai.toml      # 使用指定配置
  mgit sync --thread 8                        # 设置8个线程
  mgit sync --stash                            # 同步前暂存改动
  mgit sync --hard                             # 强制重置
  mgit sync --depth 1                          # 浅克隆
  mgit sync --silent                           # 静默模式
```

**mgit snapshot** - 创建快照
```bash
用法: mgit snapshot [OPTIONS] [PATH]

参数:
  [PATH]  要扫描的项目路径，默认为当前目录

选项:
  -c, --config <CONFIG>  指定配置文件路径，默认为.gitrepos
      --branch          生成branch快照
      --commit          生成commit快照
  -f, --force <FORCE>  强制执行并覆盖已有的配置文件
  -i, --ignore <IGNORE>  忽略的目录，可多次使用 [env: MGIT_IGNORE=]
  -h, --help            显示帮助信息

示例:
  mgit snapshot                           # 创建快照
  mgit snapshot --config release/v1.0.0.toml  # 输出到指定文件
  mgit snapshot --branch                   # 创建分支快照
  mgit snapshot --commit                   # 创建提交快照
  mgit snapshot --force                    # 强制覆盖
```

**mgit fetch** - 获取更新
```bash
用法: mgit fetch [OPTIONS] [PATH]

参数:
  [PATH]  要操作的项目路径，默认为当前目录

选项:
  -c, --config <CONFIG>  指定配置文件路径，默认为.gitrepos
  -t, --thread <THREAD>  设置线程数量，默认为4 [env: MGIT_THREAD=4]
      --silent          在sync中启用静默播报模式
      --depth <DEPTH>    设置fetch的深度 [env: MGIT_DEPTH=]
  -i, --ignore <IGNORE>  忽略的目录，可多次使用 [env: MGIT_IGNORE=]
  -h, --help            显示帮助信息

示例:
  mgit fetch                    # 获取更新
  mgit fetch --thread 8         # 设置8个线程
  mgit fetch --depth 1          # 浅获取
  mgit fetch --silent           # 静默模式
```

#### 高级命令

**mgit clean** - 清理仓库
```bash
用法: mgit clean [OPTIONS] [PATH]

参数:
  [PATH]  要操作的项目路径，默认为当前目录

选项:
  -c, --config <CONFIG>  指定配置文件路径，默认为.gitrepos
      --dry-run         预览将要删除的仓库
  -f, --force <FORCE>    强制删除，跳过确认
  -h, --help            显示帮助信息

示例:
  mgit clean                # 清理仓库（需要确认）
  mgit clean --dry-run     # 预览删除操作
  mgit clean --force        # 强制删除
```

**mgit track** - 设置跟踪
```bash
用法: mgit track [OPTIONS] [PATH]

参数:
  [PATH]  要操作的项目路径，默认为当前目录

选项:
  -c, --config <CONFIG>  指定配置文件路径，默认为.gitrepos
      --remote <REMOTE>  指定默认远程仓库
      --branch <BRANCH>  指定跟踪分支
  -i, --ignore <IGNORE>  忽略的目录，可多次使用 [env: MGIT_IGNORE=]
  -h, --help            显示帮助信息

示例:
  mgit track                          # 设置跟踪
  mgit track --remote upstream        # 指定远程仓库
  mgit track --branch main            # 跟踪main分支
```

**mgit ls-files** - 文件浏览
```bash
用法: mgit ls-files [OPTIONS] [PATH]

参数:
  [PATH]  要操作的项目路径，默认为当前目录

选项:
  -c, --config <CONFIG>  指定配置文件路径，默认为.gitrepos
      --pattern <PATTERN>  文件模式匹配
      --type <TYPE>        文件类型过滤
  -h, --help            显示帮助信息

示例:
  mgit ls-files                           # 显示所有文件
  mgit ls-files --pattern "*.md"          # 显示所有markdown文件
  mgit ls-files --type rust                # 显示Rust源码文件
```

**mgit log-repos** - 仓库日志
```bash
用法: mgit log-repos [OPTIONS] [PATH]

参数:
  [PATH]  要操作的项目路径，默认为当前目录

选项:
  -c, --config <CONFIG>      指定配置文件路径，默认为.gitrepos
      --since <SINCE>        开始时间
      --until <UNTIL>        结束时间
      --stat               显示统计信息
      --limit <LIMIT>        限制显示数量
  -h, --help                显示帮助信息

示例:
  mgit log-repos                                  # 显示日志
  mgit log-repos --since "2024-01-01"            # 从指定日期开始
  mgit log-repos --stat                           # 显示统计信息
  mgit log-repos --limit 50                       # 限制显示50条
```

#### 分支和标签管理命令

**mgit new-branch** - 创建远程分支
```bash
用法: mgit new-branch [OPTIONS] <BRANCH_NAME>

参数:
  <BRANCH_NAME>  分支名称

选项:
  -c, --config <CONFIG>  指定配置文件路径，默认为.gitrepos
      --from <FROM>      基于哪个分支创建
  -h, --help            显示帮助信息

示例:
  mgit new-branch feature/new-ui              # 创建功能分支
  mgit new-branch feature/new-ui --from main # 基于main分支创建
```

**mgit del-branch** - 删除远程分支
```bash
用法: mgit del-branch [OPTIONS] <BRANCH_NAME>

参数:
  <BRANCH_NAME>  分支名称

选项:
  -c, --config <CONFIG>  指定配置文件路径，默认为.gitrepos
  -f, --force <FORCE>    强制删除
  -h, --help            显示帮助信息

示例:
  mgit del-branch feature/old-ui    # 删除功能分支
  mgit del-branch feature/old-ui --force  # 强制删除
```

**mgit new-tag** - 创建标签
```bash
用法: mgit new-tag [OPTIONS] <TAG_NAME>

参数:
  <TAG_NAME>  标签名称

选项:
  -c, --config <CONFIG>       指定配置文件路径，默认为.gitrepos
      --message <MESSAGE>  标签信息
      --sign               创建签名标签
      --commit <COMMIT>   基于指定提交创建标签
  -h, --help               显示帮助信息

示例:
  mgit new-tag v1.0.0                           # 创建标签
  mgit new-tag v1.0.0 --message "Release 1.0.0"  # 带信息的标签
  mgit new-tag v1.0.0 --sign                    # 签名标签
  mgit new-tag v1.0.0 --commit abc123          # 基于指定提交
```

### 4.2 配置文件格式规范

#### 基本结构

MGIT使用TOML格式的配置文件来定义仓库的状态和同步策略。配置文件具有清晰的层次结构，支持多种配置选项。

```toml
# 配置文件版本（必填）
version = "1.5.1"

# 默认分支（可选）
default-branch = "main"

# 默认远程仓库（可选）
default-remote = "origin"

# 仓库配置数组（必填）
[[repos]]
local = "core-lib"
remote = "https://github.com/team/core-lib.git"
branch = "main"

[[repos]]
local = "frontend"
remote = "https://github.com/team/frontend.git"
tag = "v2.1.0"

[[repos]]
local = "monorepo"
remote = "https://github.com/company/monorepo.git"
commit = "abc123def456"
sparse = ["src/services", "config", "scripts"]
```

#### 字段详细说明

**全局字段**

- `version`：配置文件版本号（必填）
  - 用于版本兼容性检查
  - 格式：语义化版本号（如"1.5.1"）

- `default-branch`：默认分支名称（可选）
  - 当仓库配置中没有指定分支时使用
  - 常见值："main"、"master"、"develop"

- `default-remote`：默认远程仓库名称（可选）
  - 用于查找远程仓库URL
  - 常见值："origin"、"upstream"

**仓库配置字段**

每个仓库配置支持以下字段：

- `local`：本地路径（必填）
  - 相对于配置文件的路径
  - 支持嵌套目录结构

- `remote`：远程仓库URL（必填）
  - 支持HTTP、HTTPS、SSH、Git协议
  - 必须是有效的Git仓库URL

- `branch`：目标分支（可选）
  - 指定要同步的分支名称
  - 格式：`分支名`

- `tag`：目标标签（可选）
  - 指定要同步的标签名称
  - 格式：`标签名`

- `commit`：目标提交（可选）
  - 指定要同步的提交哈希
  - 格式：完整或简短的提交哈希

- `sparse`：稀疏检出路径数组（可选）
  - 指定要检出的路径模式
  - 支持通配符和正则表达式

#### 状态优先级

当同时指定多个状态字段时，MGIT按以下优先级选择：

```
commit > tag > branch > default-branch
```

这意味着：
- 如果指定了commit，将同步到该具体提交
- 如果指定了tag，将同步到该标签
- 如果指定了branch，将同步到该分支的最新提交
- 如果都没有指定，将同步到default-branch的最新提交

#### 配置示例

**功能开发配置示例**
```toml
version = "1.5.1"
default-branch = "develop"

[[repos]]
local = "core-services"
remote = "https://github.com/company/core-services.git"
branch = "feature/payment-integration"

[[repos]]
local = "frontend"
remote = "https://github.com/company/frontend.git"
branch = "feature/payment-ui"

[[repos]]
local = "api-gateway"
remote = "https://github.com/company/api-gateway.git"
tag = "v2.1.0-beta"

[[repos]]
local = "documentation"
remote = "https://github.com/company/documentation.git"
commit = "a1b2c3d"
```

**版本发布配置示例**
```toml
version = "1.5.1"
default-branch = "main"

[[repos]]
local = "core-services"
remote = "https://github.com/company/core-services.git"
tag = "v2.1.0"

[[repos]]
local = "frontend"
remote = "https://github.com/company/frontend.git"
tag = "v2.1.0"

[[repos]]
local = "api-gateway"
remote = "https://github.com/company/api-gateway.git"
tag = "v2.1.0"

[[repos]]
local = "documentation"
remote = "https://github.com/company/documentation.git"
tag = "v2.1.0"
```

**稀疏检出配置示例**
```toml
version = "1.5.1"

[[repos]]
local = "monorepo"
remote = "https://github.com/company/monorepo.git"
branch = "main"
sparse = [
    "src/services/*",
    "config/",
    "scripts/*.py",
    "*.md"
]
```

#### 配置文件命名规范

为了便于管理，建议使用以下命名规范：

- **功能开发**：`feature/功能名称.toml`
  - 示例：`feature/payment-system.toml`
  - 示例：`feature/npc-ai.toml`

- **版本发布**：`release/版本号.toml`
  - 示例：`release/v1.0.0.toml`
  - 示例：`release/v2.1.0.toml`

- **紧急修复**：`hotfix/问题描述.toml`
  - 示例：`hotfix/security-fix.toml`
  - 示例：`hotfix/memory-leak.toml`

- **测试验证**：`test/测试场景.toml`
  - 示例：`test/integration.toml`
  - 示例：`test/performance.toml`

#### 配置文件验证

MGIT在加载配置文件时会进行以下验证：

1. **格式验证**：检查TOML语法是否正确
2. **必填字段验证**：确保version和repos字段存在
3. **仓库验证**：检查local和remote字段是否有效
4. **状态验证**：验证指定的分支、标签、提交是否存在
5. **路径验证**：检查本地路径是否合法

如果发现错误，MGIT会显示详细的错误信息帮助用户修复配置。