# MGIT v1 - 产品设计大纲

## 1. 产品概述
### 1.1 产品定位
- 基于Rust开发的多仓库Git管理工具
- 团队协作驱动的配置文件版本化管理
- CLI与GUI双界面支持的企业级解决方案

### 1.2 核心价值主张
- 统一多仓库状态管理，确保团队环境一致性
- 配置文件版本化，支持开发、测试、发布全生命周期
- 高并发处理，显著提升大规模仓库操作效率

### 1.3 目标用户和使用场景
**主要用户群体**：
- 多项目开发团队（项目包含10个以内子仓库）
- DevOps工程师和团队负责人
- 需要频繁交接工作的开发人员

**核心使用场景**：
- 功能开发阶段的分支同步协作
- 版本测试时的环境统一部署
- 问题排查时的commit级别快速响应

### 1.4 产品特色和优势
- **技术优势**：Rust原生性能 + egui现代GUI + 外部Git命令安全机制
- **协作优势**：配置文件独立版本控制 + 权限继承机制
- **性能优势**：Rayon并发处理 + 跨平台支持 + 原生编译优化

## 2. 安装指南
### 2.1 系统要求
**支持的操作系统**：
- Windows 10/11 (x86_64)
- Linux (x86_64, aarch64) 
- macOS (x86_64, aarch64)

**软件依赖**：
- Git 2.0+ （推荐最新版本）
- Rust 1.76.0+ （仅源码编译需要）

### 2.2 安装方式
**预编译二进制文件安装**：
- GitHub Releases自动构建多平台版本
- 版本标签：CLI为 `1.5.1`，GUI为 `gui-1.5.1`
- 支持跨平台自动下载和安装

**从源码编译安装**：
- Linux需要GTK3等GUI依赖
- 使用Cargo构建：`cargo build --release`
- 支持workspace选择性构建

### 2.3 前置条件
**Git环境配置**：
- SSH密钥配置（推荐）或个人访问令牌
- Git全局配置（用户名、邮箱）
- 网络代理设置（如需要）

**开发环境依赖**：
- Linux：`gcc g++ cmake pkg-config fontconfig libgtk-3-dev`
- Windows：Visual Studio Build Tools
- macOS：Xcode Command Line Tools

## 3. 功能模块详解
### 3.1 核心操作模块
#### 3.1.1 初始化模块 (init)
- **功能**：智能扫描Git仓库，生成标准化配置文件
- **关键特性**：自动识别仓库类型、强制覆盖支持、配置格式验证

#### 3.1.2 快照模块 (snapshot)
- **功能**：精确记录当前所有仓库状态
- **关键特性**：分支/commit级别记录、可忽略目录、状态锁定机制

#### 3.1.3 同步模块 (sync)
- **功能**：基于配置文件的批量仓库状态更新
- **关键特性**：Rayon并发处理、Sparse checkout、安全机制(stash/hard)、深度控制

#### 3.1.4 获取更新模块 (fetch)
- **功能**：批量获取远程更新，不修改本地状态
- **关键特性**：并发获取、深度控制、更新预览

#### 3.1.5 清理模块 (clean)
- **功能**：基于配置文件的安全仓库清理
- **关键特性**：安全删除策略、磁盘空间优化

#### 3.1.6 分支跟踪模块 (track)
- **功能**：批量建立分支跟踪关系
- **关键特性**：远程分支映射、简化后续操作

### 3.2 高级功能模块
#### 3.2.1 文件浏览模块 (ls-files)
- **功能**：跨仓库文件结构浏览和搜索
- **关键特性**：统一文件树、快速定位、模式匹配

#### 3.2.2 仓库日志模块 (log-repos)
- **功能**：多仓库提交历史聚合显示
- **关键特性**：时间范围过滤、变更统计、版本追溯

#### 3.2.3 分支管理模块 (new-branch/del-branch)
- **功能**：批量远程分支操作
- **关键特性**：原子性操作、批量处理、错误回滚

#### 3.2.4 标签管理模块 (new-tag)
- **功能**：批量标签创建和管理
- **关键特性**：标签签名、里程碑标记、版本管理

### 3.3 GUI界面功能模块
#### 3.3.1 项目管理模块
- **功能**：多项目管理和快速切换
- **关键特性**：最近项目记忆、配置文件关联、工作区隔离

#### 3.3.2 配置文件管理模块
- **功能**：可视化配置文件选择和管理
- **关键特性**：外部配置加载、语义化命名支持、版本历史

#### 3.3.3 仓库状态监控模块
- **功能**：实时仓库状态可视化显示
- **关键特性**：Ahead/Behind信息、本地改动状态、可视化指示器

#### 3.3.4 批量操作界面模块
- **功能**：图形化批量操作执行
- **关键特性**：进度条显示、操作日志、错误友好提示

#### 3.3.5 设置管理模块
- **功能**：用户偏好和项目设置管理
- **关键特性**：全局设置、项目特定配置、界面主题

## 4. API参考
### 4.1 CLI命令完整参考
**核心命令**：
- `mgit init [OPTIONS] [PATH]` - 初始化配置
- `mgit sync [OPTIONS] [PATH]` - 同步仓库
- `mgit snapshot [OPTIONS] [PATH]` - 创建快照
- `mgit fetch [OPTIONS] [PATH]` - 获取更新

**高级命令**：
- `mgit clean [OPTIONS] [PATH]` - 清理仓库
- `mgit track [OPTIONS] [PATH]` - 设置跟踪
- `mgit ls-files [OPTIONS] [PATH]` - 文件浏览
- `mgit log-repos [OPTIONS] [PATH]` - 仓库日志
- `mgit new-branch [OPTIONS]` - 创建远程分支
- `mgit del-branch [OPTIONS]` - 删除远程分支
- `mgit new-tag [OPTIONS]` - 创建标签

**通用选项**：
- `--config <FILE>` - 指定配置文件
- `--thread <NUMBER>` - 设置线程数
- `--silent` - 静默模式
- `--ignore <PATH>` - 忽略目录
- `--force` - 强制执行
- `--stash` - 同步前暂存本地改动
- `--hard` - 强制重置，忽略本地改动
- `--no-track` - 不同步后不跟踪远程分支
- `--no-checkout` - 同步后不迁出新分支
- `--depth <NUMBER>` - 设置操作深度

### 4.2 配置文件格式规范
**基本结构**：
```toml
version = "1.5.1"
default-branch = "main"
default-remote = "origin"

[[repos]]
local = "path/to/repo"
remote = "https://github.com/user/repo.git"
branch = "main"
# 可选字段：tag, commit, sparse
```

**字段说明**：
- `version`：配置文件版本（必填）
- `default-branch`：默认分支
- `default-remote`：默认远程仓库
- `repos`：仓库配置数组

**仓库配置字段**：
- `local`：本地路径（必填）
- `remote`：远程仓库URL（必填）
- `branch`：目标分支
- `tag`：目标标签
- `commit`：目标提交
- `sparse`：稀疏检出路径数组

**配置示例**：
```toml
version = "1.5.1"
default-branch = "master"
default-remote = "origin"

[[repos]]
local = "core-lib"
remote = "https://github.com/team/core-lib.git"
tag = "v2.1.0"

[[repos]]
local = "frontend"
remote = "https://github.com/team/frontend.git"
branch = "feature/user-auth"

[[repos]]
local = "monorepo"
remote = "https://github.com/company/monorepo.git"
sparse = ["src/services", "config", "scripts"]
```

**状态优先级**：
```
commit > tag > branch > default-branch
```

**配置文件命名规范**：
- 功能开发：`feature/功能名称.toml`
- 版本发布：`release/版本号.toml`
- 紧急修复：`hotfix/问题描述.toml`
- 测试验证：`test/测试场景.toml`